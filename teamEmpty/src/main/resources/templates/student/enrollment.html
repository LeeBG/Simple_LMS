<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<!--수강 신청-->
<head th:insert="layout/studentHeader :: head"></head>
<body>
<header th:insert="layout/studentHeader :: header"></header>
<main>
    <div class="container mt-3">
        <!-- 검색 폼 -->
        <form method="get" class="row">
            <div class="form-group col-md-3">
                <select id="searchType" name="searchType" class="form-control">
                    <option value="all" selected>전체</option>
                    <option value="professor">교수</option>
                    <option value="subject">과목</option>
                    <option value="grade">학년</option>
                </select>
            </div>
            <div class="form-group col-md-5">
                <input type="text" id="searchKeyword" name="keyword" class="form-control" placeholder="검색어를 입력하세요"
                       th:value="${param.keyword}">
            </div>
            <div class="form-group col-md-2">
                <button type="submit" class="btn btn-primary">검색</button>
            </div>
            <div class="form-group col-md-2">
                <a th:href="'/student/enroll'"><button type="button" class="btn btn-google"><i class="fa fa-refresh text-white" aria-hidden="false"></i>초기화</button></a>
            </div>
        </form>
        <table class="table table-bordered">
            <tr>
                <td th:text="'강의명'"></td>
                <td th:text="'교수명'"></td>
                <td th:text="'학점'"></td>
                <td th:text="'강의 시작시간'"></td>
                <td th:text="'강의 끝시간'"></td>
                <td th:text="'강의 타입'"></td>
                <td th:text="'최대 / 현재 수강자'"></td>
                <td th:text="'강의 학기'"></td>
                <td th:text="'학년'"></td>
                <td th:text="'신청하기'"></td>
            </tr>
            <tr th:each="item:${list}">
                <form method="post" th:unless="${#lists.contains(lectureList, item)}">
                    <td th:text="${item.name}"></td>
                    <td th:text="${item.professor_name}"></td>
                    <td th:text="${item.credit}"></td>
                    <td th:utext="${item.day+ '<br/>' + item.start}"></td>
                    <td th:utext="${item.day+ '<br/>' + item.end}"></td>
                    <td th:text="${item.type}"></td>
                    <td th:text="${item.maxCount+ '명 / ' + item.currentCount + '명'}"></td>
                    <td th:text="${item.semester}"></td>
                    <td th:text="${item.grade}"></td>
                    <input th:type="hidden" th:value="${stuIdx}" th:name="stuIdx" required/>
                    <input th:type="hidden" th:value="${item.idx}" th:name="idx" required/>
                    <td>
                        <button type="submit" class="btn btn-primary" th:if="${item.currentCount >= item.maxCount}"
                                disabled>수강신청
                        </button>
                        <button type="submit" class="btn btn-primary" th:if="${item.currentCount < item.maxCount}">
                            수강신청
                        </button>
                    </td>
                </form>

                <form method="get" th:if="${#lists.contains(lectureList, item)}" action="/student/cancelEnroll">
                    <td th:text="${item.name}"></td>
                    <td th:text="${item.professor_name}"></td>
                    <td th:text="${item.credit}"></td>
                    <td th:utext="${item.day+ '<br/>' + item.start}"></td>
                    <td th:utext="${item.day+ '<br/>' + item.end}"></td>
                    <td th:text="${item.type}"></td>
                    <td th:text="${item.maxCount+ '명 / ' + item.currentCount + '명'}"></td>
                    <td th:text="${item.semester}"></td>
                    <td th:text="${item.grade}"></td>
                    <input th:type="hidden" th:value="${stuIdx}" th:name="stuIdx" required/>
                    <input th:type="hidden" th:value="${item.idx}" th:name="idx" required/>
                    <td>
                        <button type="submit" class="btn btn-warning">수강취소</button>
                    </td>
                </form>
            </tr>
        </table>

        <div class="m-auto mt-3" style="width: fit-content" th:if="${list.totalPages > 1}">
            <ul class="pagination">
                <li class="page-item" th:if="${list.hasPrevious && ((list.number / 5) - 1) * 5 >= 0}">
                    <a th:href="@{/student/enroll(page=${((list.number / 5) - 1) * 5})}">
                        <button class="page-link" th:text="'<<'"></button>
                    </a>
                </li>

                <li class="page-item" th:if="${list.hasPrevious}">
                    <a th:href="@{/student/enroll(page=${list.number - 1})}">
                        <button class="page-link" th:text="'<'"></button>
                    </a>
                </li>

                <li class="page-item" th:each="i : ${#numbers.sequence(0, list.totalPages - 1)}"
                    th:if="${i / 5 == list.number / 5}">
                    <a th:href="@{/student/enroll(page=${i})}">
                        <button class="page-link" disabled style="background-color: rgba(128, 128, 128, 0.5)"
                                th:if="${list.number == i}" th:text="${i + 1}"></button>
                    </a>
                    <a th:href="@{/student/enroll(page=${i})}">
                        <button class="page-link" th:unless="${list.number == i}" th:text="${i + 1}"></button>
                    </a>
                </li>

                <li class="page-item" th:if="${list.hasNext}">
                    <a th:href="@{/student/enroll(page=${list.number + 1})}">
                        <button class="page-link" th:text="'>'"></button>
                    </a>
                </li>

                <li class="page-item" th:if="${list.hasNext && list.totalPages - 1 >= ((list.number / 5) + 1) * 5}">
                    <a th:href="@{/student/enroll(page=${((list.number / 5) + 1) * 5})}">
                        <button class="page-link" th:text="'>>'"></button>
                    </a>
                </li>
            </ul>
        </div>


    </div>
</main>


<footer th:insert="layout/studentHeader :: footer"></footer>

<script th:inline="javascript">
    /*<![CDATA[*/
    $(document).ready(function () {
        let searchType = /*[[${searchType}]]*/ null;
        let keyword = /*[[${keyword}]]*/ null;

        $('.pagination a').on('click', function (event) {
            event.preventDefault();

            let href = $(this).attr('href');

            if (searchType !== null) {
                href += '&searchType=' + encodeURIComponent(searchType);
            }
            if (keyword !== null) {
                href += '&keyword=' + encodeURIComponent(keyword);
            }

            location.href = href;
        });
    });
    /*]]>*/
</script>


</body>
</html>