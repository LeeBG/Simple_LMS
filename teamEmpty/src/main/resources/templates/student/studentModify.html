<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head th:insert="layout/header :: head">

</head>
<body>
<header th:insert = "layout/header :: header" ></header>
<div class="container mt-4">
    <h2>내 정보 수정</h2>
    <hr>

    <form method="post" th:action="@{/student/studentModify/{idx}(idx=${session.user?.idx})}">
        <div class="w-50 m-auto">

            <!-- 이름 출력란 -->
            <div class="input-group input-group-sm mb-3" style="width: 70%;">
                <span class="input-group-text" style="width: 20%;">이름</span>
                <input type="text" class="form-control" name="user_name" th:value="${session.user?.user_name}" th:disabled="true">
            </div>

            <!-- 학번 출력란 -->
            <div class="input-group input-group-sm mb-3" style="width: 70%;">
                <span class="input-group-text" style="width: 20%;">학번</span>
                <input type="text" class="form-control" name="student_num" th:value="${dto?.student_num}" th:disabled="true">
            </div>

            <!-- 주소 입력란 -->
            <div class="input-group input-group-sm mb-3" style="width: 70%;">
                <span class="input-group-text" style="width: 20%;">주소</span>
                <input type="text" class="form-control" name="user_address" th:value="${session.user?.user_address}">
            </div>

            <div class="input-group input-group-sm mb-3" style="width: 70%;">
                <span class="input-group-text" style="width: 20%;">전화번호</span>
                <input type="text" class="form-control form-control-user" name="pnum" id="phonenumber"
                       placeholder="전화번호" th:value="${session.user?.pnum}" required>
            </div>

            <div class="form-group row">
                <div class="col-sm-8 mb-3 mb-sm-0">
                    <input type="email" class="form-control form-control-user"
                           id="exampleInputEmail" placeholder="Email" name="email" required>
                </div>
                <div class="col-sm-4">
                    <button type="button" class="btn btn-primary btn-user btn-block"
                            id="email_validation" disabled>인증하기</button>
                </div>
            </div>

            <!-- 이메일 입력란 -->
            <div class="form-group row" id="verificationField" style="display: none;">
                <div class="col-sm-8 mb-3 mb-sm-0">
                    <input type="text" class="form-control form-control-user" id="verificationCode"
                           placeholder="인증번호" required>
                </div>
                <div class="col-sm-4">
                    <button type="button" class="btn btn-primary btn-user btn-block">인증확인</button>
                </div>
            </div>

            <div class="w-50 m-auto">
                <button type="submit" class="btn btn-outline-secondary" style="margin-right: 10px;">수정</button>
                <button type="button" class="btn btn-outline-secondary">취소</button>
            </div>
        </div>
    </form>

    <hr>

    <div class="m-auto w-50 mt-5">
        <h2>내 정보 수정</h2>
        <br/>
        <form method="post" action="">
            <!-- 패스워드 입력란 -->
            <div class="form-group row d-flex flex-wrap">
                <div class="col-sm-12 mb-3 ">
                    <input type="password" class="form-control form-control-user"
                           id="exampleInputPassword" placeholder="패스워드" required>
                </div>

                <!-- 패스워드 확인 입력란 -->
                <div class="col-sm-12 mb-3 ">
                    <input type="password" class="form-control form-control-user"
                           id="exampleRepeatPassword" name="repeatPassword" placeholder="패스워드 확인" required>
                </div>

                <div class="col-sm-6 mb-3 justify-content-center">
                    <input type="submit" class="btn btn-facebook"
                           id="btnChangePw" name="repeatPassword" value="비밀번호 변경하기" required>
                </div>
            </div>
        </form>
    </div>
</div>
<footer th:insert="layout/header :: footer"></footer>

<script>
                window.onload = function () {
                const emailInput = document.getElementById('exampleInputEmail');
                const validationButton = document.getElementById('email_validation');
                const passwordInput = document.getElementById('exampleInputPassword');
                const repeatPasswordInput = document.getElementById('exampleRepeatPassword');
                const passwordHelp = document.getElementById('passwordHelp');
                const passwordConfirmHelp = document.getElementById('passwordConfirmHelp');

        function validateEmail(email) {
            var re = /^([a-zA-Z0-9_-])+@([a-zA-Z0-9_-])+((\.[a-zA-Z0-9_-]{2,3}){1,2})$/;
            return re.test(String(email).toLowerCase());
        }

        function validatePassword(password) {
            var re = /^(?=.*[a-z])(?=.*[0-9])(?=.*[!@#$%^&*])[a-z0-9!@#$%^&*]{8,}$/;
            return re.test(String(password));
        }

        passwordInput.addEventListener('input', function () {
            if (!validatePassword(passwordInput.value)) {
                passwordHelp.innerHTML = "총 8자 이상 숫자, 소문자, 특수문자를 각각 하나 이상 ";
                passwordHelp.style.color = "red";
            } else {
                passwordHelp.innerHTML = "";
            }
        });

        repeatPasswordInput.addEventListener('input', function () {
            if (passwordInput.value !== repeatPasswordInput.value) {
                passwordConfirmHelp.innerHTML = "패스워드가 일치하지 않습니다.";
                passwordConfirmHelp.style.color = "red";
            } else {
                passwordConfirmHelp.classList.add('text-primary');
                passwordConfirmHelp.innerHTML = "유효한 비밀번호입니다.";
            }
        });

        emailInput.addEventListener('input', function () {
            if (validateEmail(emailInput.value)) {
                validationButton.disabled = false;
            } else {
                validationButton.disabled = true;
            }
        });

        // 수정 버튼 클릭 시 이벤트 처리
        document.querySelector('.btn-outline-secondary').addEventListener('click', function () {
            // 수정 로직 추가
            alert('수정 버튼이 클릭되었습니다.');
        });

        // 취소 버튼 클릭 시 이벤트 처리
        document.querySelector('.btn-outline-secondary:last-child').addEventListener('click', function () {
            // 취소 로직 추가
            alert('취소 버튼이 클릭되었습니다.');
            return "home";
        });

    }

    $("#phonenumber").on("input", function () {
        // 숫자만 입력되도록 필터링
        $(this).val($(this).val().replace(/[^0-9]/g, ""));
        // 010이 이미 입력되어있는 상태에서 추가적으로 숫자를 입력받아 '-'를 붙이는 과정
        var inputVal = $(this).val();
        var formatted = inputVal;
        if (inputVal.length > 3) {
            var front = inputVal.substr(0, 3);
            var middle = inputVal.substr(3, 4);
            var back = inputVal.substr(7, 4);
            formatted = front;
            if (middle != "") {
                formatted += "-" + middle;
            }
            if (back != "") {
                formatted += "-" + back;
            }
        }
        $(this).val(formatted);
    });

    document.querySelector('.btn-user.btn-block').addEventListener('click', function (e) {
        e.preventDefault();
        alert('인증번호가 전송되었습니다.');
        document.getElementById('verificationField').style.display = 'flex';
    });

</script>

</body>
</html>




